<!DOCTYPE html>
<html>
<head>
<title>Office Add-In link loader</title>

<noscript>
    <p>The Add-In could not load the link as JavaScript failed to load.</p>
    <p>Please, enable JavaScript or open the link in your browser of choice.</p>
</noscript>

<p id="no-endpoint" hidden>Cannot navigate to an empty target URL.</p>

<p id="iframe-error" hidden>
    Failed to load the target URL.<br>
    Try <a id="iframe-direct" href="">following the link directly</a>.
</p>

<script type="text/javascript">
	window.addEventListener('load', () => {
        const url = new URL(location.href);

        const endpoint = url.searchParams.get("endpoint");
        if(!endpoint) {
            const noEndpoint = document.getElementById("no-endpoint");
            noEndpoint?.hidden = false;
            return;
        }
        
        const iframe = document.createElement("iframe");
        iframe.height = window.innerHeight;
        iframe.referrerPolicy = "no-referrer";
        iframe.src = endpoint;
        iframe.title = "Target resource";
        iframe.width = window.innerWidth;

        iframe.addEventListener("load", () => {
            const { contentDocument } = iframe;

            if(!contentDocument) {
                const loadError = document.getElementById("iframe-error");
                loadError?.hidden = false;

                const directLink = document.getElementById("iframe-direct");
                directLink?.href = endpoint;
            }
        });

        window.addEventListener("resize", () => {
            iframe.height = window.innerHeight;
            iframe.width = window.innerWidth;
        });

        const { sandbox } = iframe;
        sandbox.add("allow-downloads");
        sandbox.add("allow-forms");
        sandbox.add("allow-modals");
        sandbox.add("allow-popups");
        sandbox.add("allow-popups-to-escape-sandbox");
        sandbox.add("allow-scripts");

        document.body.append(iframe);
    }, { once: true });
</script>
</head>
<body></body>
</html>